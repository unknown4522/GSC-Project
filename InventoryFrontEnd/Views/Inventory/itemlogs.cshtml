@using InventoryFrontEnd.Models;
@model Modelall
@{
    ViewBag.Title = "ITEM LOGS";


}
<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-md-2 mb-4 d-flex flex-column">
                <div class="card shadow rounded-4 sidebar">
                    <div class="card-body">
                        <h4 class="text-primary">@ViewBag.campus_name</h4>
                        <h6 class="mb-3">Navigation</h6>
                        <a href="@Url.Action("Index", "Dashboard", new { campus_name = ViewBag.campus_name })"
                           class="btn btn-outline-secondary mb-2 w-100 text-start">
                            <i class="bi bi-tags me-1"></i>Home
                        </a>
                        <a href="@Url.Action("Campus", "Inventory", new { campus_name = ViewBag.campus_name })"
                           class="btn btn-outline-secondary mb-2 w-100 text-start">
                            <i class="bi bi-bank2"></i>Campus List
                        </a>
                        <a href="@Url.Action("brandlist", "Inventory", new { campus_name = ViewBag.campus_name })"
                           class="btn btn-outline-secondary mb-2 w-100 text-start">
                            <i class="bi bi-tags me-1"></i> Brand List
                        </a>
                        <a href="@Url.Action("Item_list", "Inventory", new { campus_name = ViewBag.campus_name })"
                           class="btn btn-outline-secondary mb-2 w-100 text-start">
                            <i class="bi bi-box-fill"></i> Item List
                        </a>
                        <a href="@Url.Action("rooms", "Inventory", new { campus_name = ViewBag.campus_name })"
                           class="btn btn-outline-secondary mb-2 w-100 text-start">
                            <i class="bi bi-tags me-1"></i> Room List
                        </a>
                        <a href="@Url.Action("materialslist", "Materials", new { campus_name = ViewBag.campus_name })"
                           class="btn btn-outline-secondary mb-3 w-100 text-start">
                            <i class="bi bi-tags me-1"></i>Materials List
                        </a>
                        <a href="@Url.Action("itemlogs", "Inventory", new { campus_name = ViewBag.campus_name })"
                           class="btn btn-outline-secondary mb-3 w-100 text-start">
                            <i class="bi bi-clipboard2-data"></i> Item Logs
                        </a>
                        <a href="@Url.Action("logout", "dashboard")"
                           class="btn btn-outline-secondary mb-3 w-100 text-start">
                            <i class="bi bi-box-arrow-right me-1"></i> Log Out
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 h-100 overflow-auto px-4 py-3">
                <div class="sticky-top">
                    <div class="card shadow rounded-4">
                        <div class="card-body">
                            <h2 class="text-center text-primary fw-bold">@ViewBag.campus_name</h2>
                            <h4 class="text-center text-secondary mb-4">Asset Reports</h4>
                            <div class="d-flex justify-content-end mb-3">
                                <input type="text" id="tableSearch" class="form-control w-25" placeholder="Search...">
                            </div>

                            <div class="table-responsive rounded-3 border">
                                <table class="table table-hover table-striped align-middle text-center mb-0">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>Asset Name</th>
                                            <th>Serial Number</th>
                                            <th>Date</th>
                                            <th>Process</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.Item_logs_data)
                                        {
                                            <tr class="clickable-row hover-scale"
                                                data-last-location="@item.Last_location"
                                                data-current-location="@item.Current_location"
                                                data-requested-by="@item.Requested_by"
                                                data-transfer-by="@item.Transfer_by"
                                                data-process="@item.Process"
                                                data-itemModel="@item.Model"
                                                data-itemBrand="@item.Brand"
                                                data-itemtype="@item.Item_type"
                                                data-itemstatus="@item.Item_status"
                                                data-itemDepartment="@item.Department">
                                                <td>@Html.DisplayFor(modelItem => item.Item_name)</td>
                                                <td>@Html.DisplayFor(modelItem => item.Serial_number)</td>
                                                <td>@Html.DisplayFor(modelItem => item.Date_transfer)</td>
                                                <td>@Html.DisplayFor(modelItem => item.Process)</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>

                            <div class="d-flex justify-content-center mt-4">
                                <nav>
                                    <ul class="pagination" id="pagination"></ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
         

        </div>
    </div>


    @*Modal for Item Details*@
    <div class="modal fade" id="itemDetailsModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Details</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4"><strong>FROM:</strong></div>
                        <div class="col-md-8"><span id="modalLastLocation"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-4"><strong>TO:</strong></div>
                        <div class="col-md-8"><span id="modalCurrentLocation"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-4"><strong>REQUESTED BY:</strong></div>
                        <div class="col-md-8"><span id="modalRequestedBy"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-4"><strong>TRANSFER BY:</strong></div>
                        <div class="col-md-8"><span id="modalTransferBy"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-4"><strong>PROCESS:</strong></div>
                        <div class="col-md-8"><span id="modalProcess"></span></div>
                    </div>

                    <div class="row">
                        <div class="col-md-4"><strong>MODEL:</strong></div>
                        <div class="col-md-8"><span id="modalitemmodel"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-4"><strong>BRAND:</strong></div>
                        <div class="col-md-8"><span id="modalitembrand"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-4"><strong>ITEM TYPE:</strong></div>
                        <div class="col-md-8"><span id="modalitemtype"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-4"><strong>STATUS:</strong></div>
                        <div class="col-md-8"><span id="modalitemstatus"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-4"><strong>DEPARTMENT:</strong></div>
                        <div class="col-md-8"><span id="modalitemdepartment"></span></div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

                </div>
            </div>
            
        </div>
    </div>

   <script>
       document.addEventListener("DOMContentLoaded", function () {
           const rows = document.querySelectorAll(".clickable-row");

           rows.forEach(row => {
               row.addEventListener("click", function () {
                   const lastLocation = this.querySelector("td[data-last-location]").getAttribute("data-last-location");
                   const currentLocation = this.querySelector("td[data-current-location]").getAttribute("data-current-location");
                   const requestedBy = this.querySelector("td[data-requested-by]").getAttribute("data-requested-by");
                   const transferBy = this.querySelector("td[data-transfer-by]").getAttribute("data-transfer-by");
                   const Process = this.querySelector("td[data-process]").getAttribute("data-process");
                   const Model = this.querySelector("td[data-itemModel]").getAttribute("data-itemModel");
                   const Brand = this.querySelector("td[data-itemBrand]").getAttribute("data-itemBrand");
                   const Itemtype = this.querySelector("td[data-itemtype]").getAttribute("data-itemtype");
                   const Itemstatus = this.querySelector("td[data-itemstatus]").getAttribute("data-itemstatus");
                   const Department = this.querySelector("td[data-itemDepartment]").getAttribute("data-itemDepartment");

                   document.getElementById("modalLastLocation").textContent = lastLocation;
                   document.getElementById("modalCurrentLocation").textContent = currentLocation;
                   document.getElementById("modalRequestedBy").textContent = requestedBy;
                   document.getElementById("modalTransferBy").textContent = transferBy;
                   document.getElementById("modalProcess").textContent = Process;
                   document.getElementById("modalitemmodel").textContent = Model;
                   document.getElementById("modalitembrand").textContent = Brand;
                   document.getElementById("modalitemtype").textContent = Itemtype;
                   document.getElementById("modalitemstatus").textContent = Itemstatus;
                   document.getElementById("modalitemdepartment").textContent = Department;

                   $('#itemDetailsModal').modal('show');
               });
           });

   </script>
    <script>
           $(document).ready(function () {
               function compareDates(a, b) {
                   return new Date(b) - new Date(a);
               }
               var $tbody = $("table tbody");
               $tbody.find("tr").sort(function (a, b) {
                   var dateA = $(a).find("td:nth-child(3)").text();
                   var dateB = $(b).find("td:nth-child(3)").text();
                   return compareDates(dateA, dateB);
               }).appendTo($tbody);
           });

           document.addEventListener("DOMContentLoaded", function () {
               const rows = document.querySelectorAll(".clickable-row");

               rows.forEach(row => {
                   row.addEventListener("click", function () {
                       const lastLocation = this.querySelector("td[data-last-location]").getAttribute("data-last-location");
                       const currentLocation = this.querySelector("td[data-current-location]").getAttribute("data-current-location");
                       const requestedBy = this.querySelector("td[data-requested-by]").getAttribute("data-requested-by");
                       const transferBy = this.querySelector("td[data-transfer-by]").getAttribute("data-transfer-by");
                       const Process = this.querySelector("td[data-process]").getAttribute("data-process");
                       const Model = this.querySelector("td[data-itemModel]").getAttribute("data-itemModel");
                       const Brand = this.querySelector("td[data-itemBrand]").getAttribute("data-itemBrand");
                       const Itemtype = this.querySelector("td[data-itemtype]").getAttribute("data-itemtype");
                       const Itemstatus = this.querySelector("td[data-itemstatus]").getAttribute("data-itemstatus");
                       const Department = this.querySelector("td[data-itemDepartment]").getAttribute("data-itemDepartment");

                       document.getElementById("modalLastLocation").textContent = lastLocation;
                       document.getElementById("modalCurrentLocation").textContent = currentLocation;
                       document.getElementById("modalRequestedBy").textContent = requestedBy;
                       document.getElementById("modalTransferBy").textContent = transferBy;
                       document.getElementById("modalProcess").textContent = Process;
                       document.getElementById("modalitemmodel").textContent = Model;
                       document.getElementById("modalitembrand").textContent = Brand;
                       document.getElementById("modalitemtype").textContent = Itemtype;
                       document.getElementById("modalitemstatus").textContent = Itemstatus;
                       document.getElementById("modalitemdepartment").textContent = Department;

                       $('#itemDetailsModal').modal('show');
                   });
               });
           });
    </script>
    <script>
            function searchTable() {
                var input, filter, table, tr, td, i, txtValue;
                input = document.getElementById("tableSearch");
                filter = input.value.toUpperCase();
                table = document.querySelector(".table-striped");
                tr = table.getElementsByTagName("tr");

                for (i = 1; i < tr.length; i++) {  // Start loop from index 1 to exclude header
                    td = tr[i].getElementsByTagName("td");
                    for (var j = 0; j < td.length; j++) {
                        if (td[j]) {
                            txtValue = td[j].innerText || td[j].textContent;
                            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                                tr[i].style.display = "";
                                break;
                            } else {
                                tr[i].style.display = "none";
                            }
                        }
                    }
                }
            }

            document.getElementById("tableSearch").addEventListener("keyup", searchTable);

    </script>
    <script>
            $(document).ready(function () {
                var rowsPerPage = 10;
                var rows = $('table tbody tr');
                var pagination = $('#pagination');
                var rowsCount = rows.length;
                var pageCount = Math.ceil(rowsCount / rowsPerPage);

                function displayRows(page) {
                    rows.hide();
                    var start = page * rowsPerPage;
                    rows.slice(start, start + rowsPerPage).show();
                }

                function setupPagination() {
                    pagination.empty();
                    for (var i = 0; i < pageCount; i++) {
                        pagination.append(
                            `<li class="page-item"><a class="page-link" href="#">${i + 1}</a></li>`
                        );
                    }
                    pagination.find('li:first').addClass('active');
                }

                setupPagination();
                displayRows(0);

                pagination.on('click', 'li', function (e) {
                    e.preventDefault();
                    var index = $(this).index();
                    pagination.find('li').removeClass('active');
                    $(this).addClass('active');
                    displayRows(index);
                });

                // Click row redirect
                $('.clickable-row').click(function () {
                    window.location = $(this).data('href');
                });
            });

    </script>
    <script>
           $(document).ready(function () {
               var rowsPerPage = 5;
               var rows = $('table tbody tr');
               var pagination = $('#pagination');
               var rowsCount = rows.length;
               var pageCount = Math.ceil(rowsCount / rowsPerPage);

               function displayRows(page) {
                   rows.hide();
                   var start = page * rowsPerPage;
                   rows.slice(start, start + rowsPerPage).show();
               }

               function setupPagination() {
                   pagination.empty();
                   for (var i = 0; i < pageCount; i++) {
                       pagination.append(
                           `<li class="page-item"><a class="page-link" href="#">${i + 1}</a></li>`
                       );
                   }
                   pagination.find('li:first').addClass('active');
               }

               setupPagination();
               displayRows(0);

               pagination.on('click', 'li', function (e) {
                   e.preventDefault();
                   var index = $(this).index();
                   pagination.find('li').removeClass('active');
                   $(this).addClass('active');
                   displayRows(index);
               });

               // Click row redirect
               $('.clickable-row').click(function () {
                   window.location = $(this).data('href');
               });
           });
    </script>
</body>